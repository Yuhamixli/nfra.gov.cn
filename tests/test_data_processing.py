"""
测试数据处理逻辑的修复效果
"""

from data_processor import DataProcessor
import json

def test_data_processing():
    """测试数据处理逻辑"""
    
    # 模拟完整的处罚数据
    sample_data = {
        "当事人名称": "复星联合健康保险股份有限公司",
        "主要违法违规行为": "一、委托未取得合法资格的个人从事保险销售活动；二、财务业务数据不真实；三、未按照规定使用经备案的保险条款；四、虚挂中介业务套取费用",
        "行政处罚内容": "对复星联合健康保险股份有限公司委托未取得合法资格的个人从事保险销售活动的违法违规行为，根据《保险公司管理规定》第五十四条、《中华人民共和国保险法》第八十六条规定，罚款30万元；对复星联合健康保险股份有限公司财务业务数据不真实的违法违规行为，根据《中华人民共和国保险法》第一百三十五条规定，罚款42万元；对复星联合健康保险股份有限公司未按照规定使用经备案的保险条款的违法违规行为，根据《中华人民共和国保险法》第一百一十六条规定，罚款58万元；对复星联合健康保险股份有限公司虚挂中介业务套取费用的违法违规行为，根据《中华人民共和国保险法》第一百六十一条规定，罚款28万元；以上合计对复星联合健康保险股份有限公司罚款158万元。对项开宝作为复星联合健康保险股份有限公司总经理、主管相关业务的高级管理人员，对上述违法违规行为负有直接管理责任，根据《中华人民共和国保险法》第一百七十条规定，警告并罚款1万元。对陈雄斌作为复星联合健康保险股份有限公司董事长、主管相关业务的高级管理人员，对上述违法违规行为负有直接管理责任，根据《中华人民共和国保险法》第一百七十一条规定，警告并罚款2万元。对刘益成作为复星联合健康保险股份有限公司数据治理部负责人、直接负责的主管人员，对财务业务数据不真实的违法违规行为负有直接责任，根据《中华人民共和国保险法》第一百七十一条规定，警告并罚款1万元。",
        "作出决定机关": "国家金融监督管理总局",
        "处罚金额": "158万元",  # 这个字段应该被格式化
        "标题": "国家金融监督管理总局行政处罚决定书（金罚决字〔2024〕36号）",
        "详情链接": "https://www.nfra.gov.cn/cn/view/pages/ItemDetail.html?docId=1170162&itemId=4113&generaltype=9"
    }
    
    print("=" * 80)
    print("原始数据:")
    print("=" * 80)
    print(json.dumps(sample_data, ensure_ascii=False, indent=2))
    
    # 初始化数据处理器
    processor = DataProcessor()
    
    # 处理数据
    processed_data = processor.clean_punishment_data(sample_data)
    
    print("\n" + "=" * 80)
    print("处理后数据:")
    print("=" * 80)
    print(json.dumps(processed_data, ensure_ascii=False, indent=2))
    
    # 重点检查行政处罚内容是否保持完整
    print("\n" + "=" * 80)
    print("行政处罚内容对比:")
    print("=" * 80)
    print("原始:")
    print(sample_data.get("行政处罚内容", "无")[:200] + "...")
    print("\n处理后:")
    print(processed_data.get("行政处罚内容", "无")[:200] + "...")
    
    # 检查金额字段是否正确格式化
    print("\n" + "=" * 80)
    print("金额字段对比:")
    print("=" * 80)
    print(f"原始处罚金额: {sample_data.get('处罚金额', '无')}")
    print(f"处理后处罚金额: {processed_data.get('处罚金额', '无')}")
    
    print("\n测试完成!")

if __name__ == "__main__":
    test_data_processing() 